<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>è„³æ±ã‚ªãƒªãƒ‘ | è¦šé†’ãƒ¢ãƒ¼ãƒ‰</title>
<style>
  :root {
    --gold: #FFD700;
    --red: #ff2a2a;
    --blue: #2a2aff;
    --green: #2aff2a;
    --rainbow: linear-gradient(135deg, #ff2400, #e81d1d, #e8b71d, #e3e81d, #1de840, #1ddde8, #2b1de8, #dd00f3, #dd00f3);
    --bg-dark: #050505;
    --card-bg: #1a1a1a;
  }

  body {
    margin: 0;
    background-color: var(--bg-dark);
    color: #fff;
    font-family: "Arial Black", sans-serif;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    height: 100vh;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }

  /* --- ãƒ˜ãƒƒãƒ€ãƒ¼ --- */
  header {
    background: rgba(0,0,0,0.9);
    padding: 10px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 2px solid #333;
    z-index: 100;
    box-shadow: 0 5px 20px rgba(0,0,0,0.8);
  }
  .points-box {
    background: linear-gradient(to right, #222, #444);
    padding: 5px 15px;
    border-radius: 20px;
    border: 2px solid var(--gold);
    color: var(--gold);
    font-weight: bold;
    text-shadow: 0 0 5px var(--gold);
    font-size: 14px;
  }

  /* --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ --- */
  .tier-tabs {
    display: flex;
    background: #111;
    border-bottom: 1px solid #333;
  }
  .tier-tab {
    flex: 1;
    text-align: center;
    padding: 15px 0;
    font-size: 14px;
    color: #666;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: 0.3s;
  }
  .tier-tab.active {
    color: #fff;
    background: linear-gradient(to bottom, #222, #000);
  }
  .tier-tab.active[data-tier="500"] { border-bottom-color: var(--blue); text-shadow: 0 0 5px var(--blue); }
  .tier-tab.active[data-tier="1000"] { border-bottom-color: var(--green); text-shadow: 0 0 5px var(--green); }
  .tier-tab.active[data-tier="2000"] { border-bottom-color: var(--gold); text-shadow: 0 0 5px var(--gold); }

  /* --- ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ --- */
  .main-stage {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 20px;
    overflow-y: auto;
    background-image: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
  }

  .banner {
    width: 100%;
    max-width: 400px;
    height: 180px;
    background: #000;
    margin-bottom: 20px;
    border-radius: 10px;
    border: 2px solid #444;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    position: relative;
    overflow: hidden;
    background-size: cover;
    background-position: center;
  }
  .banner-text {
    font-size: 32px;
    font-weight: 900;
    z-index: 2;
    text-shadow: 0 4px 10px rgba(0,0,0,0.8);
  }
  .banner-sub {
    font-size: 14px;
    color: #ddd;
    z-index: 2;
    background: rgba(0,0,0,0.6);
    padding: 2px 10px;
    border-radius: 4px;
    margin-top: 5px;
  }

  /* ãƒœã‚¿ãƒ³ç¾¤ */
  .gacha-controls {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    width: 100%;
    max-width: 400px;
    margin-bottom: 40px;
  }
  .gacha-btn {
    border: none;
    padding: 15px 0;
    font-size: 14px;
    font-weight: 900;
    color: white;
    border-radius: 8px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: transform 0.1s;
    text-shadow: 0 2px 0 rgba(0,0,0,0.5);
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .gacha-btn:active { transform: scale(0.95); }
  
  .btn-single {
    background: linear-gradient(180deg, #555 0%, #333 100%);
    box-shadow: 0 4px 0 #222;
    grid-column: 1 / 3;
  }
  .btn-10 {
    background: linear-gradient(180deg, #e94343 0%, #a82e2e 100%);
    box-shadow: 0 4px 0 #681515;
  }
  .btn-100 {
    background: linear-gradient(180deg, #e9b443 0%, #a8822e 100%);
    box-shadow: 0 4px 0 #685015;
  }
  .cost-label { font-size: 11px; margin-top: 2px; opacity: 0.9; font-weight: normal; }

  /* --- ãƒ•ãƒƒã‚¿ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ --- */
  .footer-menu {
    background: #111;
    border-top: 1px solid #333;
    display: flex;
    justify-content: space-around;
    padding: 10px 0;
    position: sticky; bottom: 0;
    z-index: 900;
  }
  .menu-item {
    color: #888;
    text-align: center;
    font-size: 10px;
    cursor: pointer;
    width: 50%;
  }
  .menu-item.active { color: var(--gold); }
  .menu-icon { font-size: 20px; display: block; margin-bottom: 2px; }

  /* --- æ¼”å‡ºã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ (ãƒ‘ãƒãƒ³ã‚³ãƒ‘ãƒ¼ãƒˆ) --- */
  .cutin-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.95);
    z-index: 2000;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .aura-orb {
    width: 150px; height: 150px;
    border-radius: 50%;
    margin-bottom: 50px;
    position: relative;
    transition: all 0.3s ease;
    animation: float 2s ease-in-out infinite;
  }
  .aura-orb.blue { background: radial-gradient(circle, #fff, var(--blue)); box-shadow: 0 0 60px var(--blue); }
  .aura-orb.green { background: radial-gradient(circle, #fff, var(--green)); box-shadow: 0 0 60px var(--green); }
  .aura-orb.red { background: radial-gradient(circle, #fff, var(--red)); box-shadow: 0 0 80px var(--red); animation: shake-hard 0.2s infinite; }
  .aura-orb.rainbow { background: var(--rainbow); box-shadow: 0 0 100px #ff00de; animation: spin 1s linear infinite; }

  .push-btn {
    width: 100px; height: 100px;
    border-radius: 50%;
    border: 4px solid #fff;
    background: radial-gradient(circle, #ff0000 0%, #880000 100%);
    color: #fff;
    font-size: 20px;
    font-weight: 900;
    cursor: pointer;
    box-shadow: 0 0 30px rgba(255,0,0,0.5), inset 0 0 20px rgba(0,0,0,0.5);
    animation: pulse-btn 0.5s infinite alternate;
    display: flex; align-items: center; justify-content: center;
    z-index: 2001;
  }
  .push-btn:active { transform: scale(0.9); }

  .cutin-text {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%) scale(0);
    font-size: 60px; font-weight: 900; color: #fff;
    text-shadow: 0 0 20px red; white-space: nowrap;
    z-index: 3000; pointer-events: none;
  }
  .cutin-anim { animation: cutin-show 0.6s ease-out forwards; }

  /* --- çµæœï¼†ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªå…±é€šã‚°ãƒªãƒƒãƒ‰ --- */
  .overlay-screen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #111;
    z-index: 1500;
    display: none;
    flex-direction: column;
    padding: 10px;
    box-sizing: border-box;
  }
  
  .screen-header {
    text-align: center; margin-bottom: 10px;
    font-size: 20px; color: #fff; border-bottom: 1px solid #333; padding-bottom: 10px;
    display: flex; justify-content: space-between; align-items: center;
  }

  .scroll-area {
    flex: 1; overflow-y: auto; padding-bottom: 80px;
  }

  .card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
    gap: 8px;
  }

  .grid-card {
    aspect-ratio: 2/3;
    background: #222;
    border-radius: 6px;
    border: 1px solid #444;
    position: relative;
    overflow: hidden;
    cursor: pointer;
  }
  /* å£²å´é¸æŠæ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
  .grid-card.selected {
    border: 3px solid #ff4444;
    opacity: 0.6;
  }
  .grid-card.selected::after {
    content: "å£²å´";
    position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
    background: red; color: white; font-size: 12px; padding: 2px 6px; border-radius: 4px;
  }

  .grid-card.SSR { border: 2px solid var(--gold); box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
  .grid-card.SR { border: 1px solid #ffaa00; }
  
  .grid-card img { width: 100%; height: 100%; object-fit: cover; }
  .grid-card .info {
    position: absolute; bottom: 0; width: 100%;
    background: rgba(0,0,0,0.85);
    color: #fff; font-size: 9px; text-align: center; padding: 3px 0;
  }

  /* --- ä¸‹éƒ¨å›ºå®šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ (å£²å´ç”¨) --- */
  .action-bar {
    position: absolute; bottom: 0; left: 0; width: 100%;
    background: #222; border-top: 1px solid #444;
    padding: 15px; box-sizing: border-box;
    display: flex; justify-content: space-between; align-items: center;
  }
  .sell-btn {
    background: #ff4444; color: #fff; border: none; padding: 10px 20px;
    border-radius: 20px; font-weight: bold; cursor: pointer;
  }
  .sell-btn:disabled { background: #555; color: #888; }

  /* --- ãƒ›ãƒ¯ã‚¤ãƒˆã‚¢ã‚¦ãƒˆ --- */
  .flash-bang {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: white; z-index: 5000; opacity: 0; pointer-events: none;
  }
  .flash-active { animation: flash 0.5s ease-out forwards; }

  /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®šç¾© */
  @keyframes pulse { to { transform: scale(1.05); } }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
  @keyframes shake-hard { 0% { transform: translate(2px, 2px); } 100% { transform: translate(-2px, -2px); } }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  @keyframes pulse-btn { 0% { transform: scale(1); box-shadow: 0 0 10px red; } 100% { transform: scale(1.1); box-shadow: 0 0 30px red; } }
  @keyframes flash { 0% { opacity: 0; } 20% { opacity: 1; } 100% { opacity: 0; } }
  @keyframes cutin-show { 
    0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); opacity: 0; } 
    60% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
  }

</style>
</head>
<body>

<header>
  <div style="font-style:italic;">è„³æ±ORIPA</div>
  <div class="points-box" id="headerPoints">10,000 pt</div>
</header>

<div class="tier-tabs">
  <div class="tier-tab active" onclick="switchTier(500)" data-tier="500">500å††<br>ãƒãƒ¼ãƒãƒ«</div>
  <div class="tier-tab" onclick="switchTier(1000)" data-tier="1000">1,000å††<br>ãƒ¬ã‚¢</div>
  <div class="tier-tab" onclick="switchTier(2000)" data-tier="2000">2,000å††<br>è¶…æ¿€ç†±</div>
</div>

<div class="main-stage">
  <div class="banner" id="tierBanner">
    <div class="banner-text" id="bannerTitle">BEGINNER</div>
    <div class="banner-sub" id="bannerSub">SSRç¢ºç‡ 1%</div>
  </div>
  
  <div class="gacha-controls">
    <button class="gacha-btn btn-single" onclick="tryGacha(1)">
      å˜ç™ºã‚¬ãƒãƒ£
      <span class="cost-label" id="cost1">500 pt</span>
    </button>
    <button class="gacha-btn btn-10" onclick="tryGacha(10)">
      10é€£ã‚¬ãƒãƒ£
      <span class="cost-label" id="cost10">5,000 pt</span>
    </button>
    <button class="gacha-btn btn-100" onclick="tryGacha(100)">
      100é€£ã‚¬ãƒãƒ£
      <span class="cost-label" id="cost100">50,000 pt</span>
    </button>
  </div>
  
  <div style="color:#666; font-size:12px; text-align:center;">
    â€»ç¢ºç‡ã¯æ¼”å‡ºä¸Šã®ã‚‚ã®ã§ã™ã€‚<br>
    â€»å®Ÿåœ¨ã®ã‚«ãƒ¼ãƒ‰ã¨ã¯é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚
  </div>
</div>

<div class="footer-menu">
  <div class="menu-item active" onclick="showMain()">
    <span class="menu-icon">ğŸ </span>ã‚¬ãƒãƒ£
  </div>
  <div class="menu-item" onclick="openInventory()">
    <span class="menu-icon">ğŸƒ</span>ã‚«ãƒ¼ãƒ‰ä¸€è¦§/å£²å´
  </div>
</div>

<div class="cutin-overlay" id="cutinOverlay">
  <div style="color:#fff; margin-bottom:20px; font-weight:bold; letter-spacing:2px;">TAP TO CHARGE!</div>
  <div class="aura-orb blue" id="auraOrb"></div>
  <div class="push-btn" id="pushBtn">PUSH</div>
  <div class="cutin-text" id="cutinText">æ¿€ç†±!!</div>
</div>

<div class="overlay-screen" id="resultScreen">
  <div class="screen-header">
    <span>RESULT</span>
    <button onclick="closeResult()" style="background:none; border:1px solid #fff; color:#fff; padding:5px 10px; border-radius:4px;">é–‰ã˜ã‚‹</button>
  </div>
  <div class="scroll-area">
    <div class="card-grid" id="resultGrid"></div>
  </div>
</div>

<div class="overlay-screen" id="inventoryScreen">
  <div class="screen-header">
    <span>æ‰€æœ‰ã‚«ãƒ¼ãƒ‰</span>
    <span style="font-size:12px; color:#aaa;">ã‚¿ãƒƒãƒ—ã§é¸æŠ</span>
  </div>
  <div class="scroll-area">
    <div class="card-grid" id="inventoryGrid"></div>
  </div>
  <div class="action-bar">
    <div style="color:#fff; font-size:14px;">
      é¸æŠä¸­: <span id="sellCount">0</span>æš<br>
      å£²å´é¡: <span id="sellValue" style="color:var(--gold); font-size:16px;">0</span> pt
    </div>
    <button class="sell-btn" id="sellBtn" onclick="sellSelectedCards()" disabled>å£²å´ã™ã‚‹</button>
  </div>
</div>

<div class="flash-bang" id="flashBang"></div>

<script>
  // --- è¨­å®šãƒ‡ãƒ¼ã‚¿ ---
  let userPoints = 10000;
  let currentTier = 500;
  let myCards = []; // æ‰€æœ‰ã‚«ãƒ¼ãƒ‰ {id, tier, name, rarity, point, img, uniqueId}

  // ãƒ†ã‚£ã‚¢ã”ã¨ã®æ’å‡ºè¨­å®š
  const TIERS = {
    500: {
      name: "BEGINNER", sub: "SSRç¢ºç‡ 1%",
      colors: ["#333", "#555"],
      pool: [
        { r:"SSR", w:1, pt:10000, name:"é’çœ¼ã®å·¨ç¥" },
        { r:"SR", w:5, pt:2000, name:"è¦‹ç¿’ã„é­”å°å¸«" },
        { r:"R", w:30, pt:300, name:"æˆ¦å£«ã®å‰£" },
        { r:"C", w:64, pt:50, name:"ãŸã ã®çŸ³" }
      ]
    },
    1000: {
      name: "STANDARD", sub: "SSRç¢ºç‡ 5%",
      colors: ["#004400", "#002200"],
      pool: [
        { r:"SSR", w:5, pt:30000, name:"ç´…è“®ã®ç«œç‹" },
        { r:"SR", w:15, pt:4000, name:"ã‚¨ãƒ«ãƒ•ã®å‰£å£«" },
        { r:"R", w:40, pt:500, name:"é­”æ³•ã®å£º" },
        { r:"C", w:40, pt:100, name:"ã‚´ãƒ–ãƒªãƒ³" }
      ]
    },
    2000: {
      name: "ULTIMATE", sub: "SSRç¢ºç‡ 10% / çˆ†æ­»æ³¨æ„",
      colors: ["#440000", "#220000"],
      pool: [
        { r:"SSR", w:10, pt:100000, name:"å…‰ã®å‰µé€ ç¥" },
        { r:"SR", w:20, pt:8000, name:"æš—é»’é¨å£«" },
        { r:"R", w:30, pt:1000, name:"è˜‡ç”Ÿé­”æ³•" },
        { r:"C", w:40, pt:200, name:"ã‚¹ãƒ©ã‚¤ãƒ " }
      ]
    }
  };

  // --- åˆæœŸåŒ– ---
  updateUI();

  // --- ãƒ†ã‚£ã‚¢åˆ‡ã‚Šæ›¿ãˆ ---
  function switchTier(price) {
    currentTier = price;
    
    // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
    document.querySelectorAll('.tier-tab').forEach(el => {
      el.classList.remove('active');
      if(parseInt(el.dataset.tier) === price) el.classList.add('active');
    });

    // ãƒãƒŠãƒ¼ã¨ãƒœã‚¿ãƒ³è¡¨ç¤ºæ›´æ–°
    const info = TIERS[price];
    const banner = document.getElementById('tierBanner');
    document.getElementById('bannerTitle').innerText = info.name;
    document.getElementById('bannerSub').innerText = info.sub;
    
    // èƒŒæ™¯è‰²å¤‰æ›´ï¼ˆé›°å›²æ°—ã¥ãã‚Šï¼‰
    banner.style.backgroundImage = `linear-gradient(45deg, ${info.colors[0]}, ${info.colors[1]})`;

    document.getElementById('cost1').innerText = `${price.toLocaleString()} pt`;
    document.getElementById('cost10').innerText = `${(price*10).toLocaleString()} pt`;
    document.getElementById('cost100').innerText = `${(price*100).toLocaleString()} pt`;
  }

  function updateUI() {
    document.getElementById('headerPoints').innerText = userPoints.toLocaleString() + " pt";
  }

  // --- ã‚¬ãƒãƒ£ãƒ­ã‚¸ãƒƒã‚¯ ---
  let tempResults = [];
  let maxRarityVal = 0; // æ¼”å‡ºç”¨
  let currentAura = 0;

  function tryGacha(count) {
    const cost = currentTier * count;
    if (userPoints < cost) {
      alert("ãƒã‚¤ãƒ³ãƒˆãŒè¶³ã‚Šã¾ã›ã‚“ï¼");
      return;
    }
    userPoints -= cost;
    updateUI();

    tempResults = [];
    maxRarityVal = 0;
    const pool = TIERS[currentTier].pool;
    const totalW = pool.reduce((a,c)=>a+c.w, 0);

    for(let i=0; i<count; i++){
      let r = Math.random() * totalW;
      let selected = pool[pool.length-1];
      for(let card of pool){
        r -= card.w;
        if(r < 0) { selected = card; break; }
      }
      
      // ç”»åƒURLç”Ÿæˆ (ãã‚Œã£ã½ãè¦‹ã›ã‚‹)
      const color = selected.r === 'SSR' ? '000000' : (selected.r === 'SR' ? 'aa8800' : '555555');
      const text = selected.r === 'SSR' ? 'GOD' : selected.r;
      const imgUrl = `https://placehold.jp/30/${color}/ffffff/150x225.png?text=${encodeURIComponent(text)}%0A${encodeURIComponent(selected.name)}`;

      // ç²å¾—ã‚«ãƒ¼ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
      const newCard = {
        uniqueId: Date.now() + Math.random(), // å£²å´è­˜åˆ¥ç”¨
        tier: currentTier,
        rarity: selected.r,
        name: selected.name,
        point: selected.pt,
        img: imgUrl
      };
      
      tempResults.push(newCard);
      
      // æ¼”å‡ºç”¨æœ€å¤§å€¤è¨ˆç®—
      let v = 0;
      if(selected.r==='R') v=1;
      if(selected.r==='SR') v=2;
      if(selected.r==='SSR') v=3;
      if(v > maxRarityVal) maxRarityVal = v;
    }

    startAnimation();
  }

  // --- æ¼”å‡º ---
  function startAnimation() {
    const overlay = document.getElementById('cutinOverlay');
    overlay.style.display = 'flex';
    document.getElementById('cutinText').style.display = 'none';
    currentAura = 0;
    updateAura();
    
    document.getElementById('pushBtn').onclick = () => {
      // æ˜‡æ ¼æŠ½é¸
      const orb = document.getElementById('auraOrb');
      orb.style.animation = 'none';
      orb.offsetHeight; 
      orb.style.animation = 'shake-hard 0.2s';

      if (currentAura < maxRarityVal) {
        if(Math.random() < 0.4 || maxRarityVal === 3) {
          currentAura++;
          updateAura();
        }
      }
      
      // çµ‚äº†åˆ¤å®š
      if (currentAura === 3 || Math.random() < 0.15) {
        finishAnimation();
      }
    };
  }

  function updateAura() {
    const orb = document.getElementById('auraOrb');
    orb.className = 'aura-orb';
    if(currentAura === 0) orb.classList.add('blue');
    else if(currentAura === 1) orb.classList.add('green');
    else if(currentAura === 2) orb.classList.add('red');
    else if(currentAura >= 3) orb.classList.add('rainbow');
  }

  function finishAnimation() {
    document.getElementById('pushBtn').onclick = null;
    
    // é€†è»¢æ¼”å‡ºï¼ˆè‰²ãŒè¶³ã‚Šãªã„å ´åˆåˆã‚ã›ã‚‹ï¼‰
    if(currentAura < maxRarityVal) {
      currentAura = maxRarityVal;
      updateAura();
    }

    if(maxRarityVal === 3) showCutin("è¦šé†’!!", showResult);
    else if(maxRarityVal === 2) showCutin("æ¿€ç†±!!", showResult);
    else showResult();
  }

  function showCutin(text, callback) {
    const el = document.getElementById('cutinText');
    el.innerText = text;
    el.style.display = 'block';
    el.classList.remove('cutin-anim');
    el.offsetHeight;
    el.classList.add('cutin-anim');
    
    setTimeout(() => {
      document.getElementById('flashBang').classList.add('flash-active');
      setTimeout(() => {
        callback();
        document.getElementById('flashBang').classList.remove('flash-active');
        document.getElementById('cutinOverlay').style.display = 'none';
      }, 300);
    }, 800);
  }

  function showResult() {
    document.getElementById('cutinOverlay').style.display = 'none';
    const grid = document.getElementById('resultGrid');
    grid.innerHTML = "";
    
    tempResults.forEach((card, i) => {
      // åœ¨åº«ã«è¿½åŠ 
      myCards.push(card);

      const el = document.createElement('div');
      el.className = `grid-card ${card.rarity}`;
      el.style.animation = `card-appear 0.3s ease forwards ${i*0.03}s`;
      el.style.opacity = "0";
      el.innerHTML = `
        <img src="${card.img}">
        <div class="info">
          <span style="color:${getRColor(card.rarity)}">${card.rarity}</span><br>
          ${card.point.toLocaleString()}pt
        </div>
      `;
      grid.appendChild(el);
    });
    document.getElementById('resultScreen').style.display = 'flex';
  }

  function closeResult() {
    document.getElementById('resultScreen').style.display = 'none';
  }

  function getRColor(r) {
    if(r==='SSR') return 'gold';
    if(r==='SR') return 'orange';
    return 'white';
  }

  // --- ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒª & å£²å´ ---
  
  function showMain() {
    document.getElementById('inventoryScreen').style.display = 'none';
  }

  let selectedCards = new Set();

  function openInventory() {
    document.getElementById('inventoryScreen').style.display = 'flex';
    renderInventory();
  }

  function renderInventory() {
    const grid = document.getElementById('inventoryGrid');
    grid.innerHTML = "";
    selectedCards.clear();
    updateSellUI();

    if(myCards.length === 0) {
      grid.innerHTML = "<div style='color:#666; text-align:center; padding:20px; grid-column:1/-1;'>ã‚«ãƒ¼ãƒ‰ã‚’æŒã£ã¦ã„ã¾ã›ã‚“</div>";
      return;
    }

    // æ–°ã—ã„é †ã«è¡¨ç¤º
    [...myCards].reverse().forEach(card => {
      const el = document.createElement('div');
      el.className = `grid-card ${card.rarity}`;
      el.dataset.id = card.uniqueId;
      el.innerHTML = `
        <img src="${card.img}">
        <div class="info">
          ${card.point.toLocaleString()}pt
        </div>
      `;
      
      // ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠ/è§£é™¤
      el.onclick = () => {
        if(selectedCards.has(card.uniqueId)) {
          selectedCards.delete(card.uniqueId);
          el.classList.remove('selected');
        } else {
          selectedCards.add(card.uniqueId);
          el.classList.add('selected');
        }
        updateSellUI();
      };
      
      grid.appendChild(el);
    });
  }

  function updateSellUI() {
    const count = selectedCards.size;
    let totalVal = 0;
    
    selectedCards.forEach(uid => {
      const c = myCards.find(x => x.uniqueId === uid);
      if(c) totalVal += c.point;
    });

    document.getElementById('sellCount').innerText = count;
    document.getElementById('sellValue').innerText = totalVal.toLocaleString();
    document.getElementById('sellBtn').disabled = (count === 0);
  }

  function sellSelectedCards() {
    if(selectedCards.size === 0) return;
    if(!confirm(`${selectedCards.size}æšã®ã‚«ãƒ¼ãƒ‰ã‚’å£²å´ã—ã¾ã™ã‹ï¼Ÿ`)) return;

    let sellTotal = 0;
    // å£²å´å¯¾è±¡ã®ãƒã‚¤ãƒ³ãƒˆé›†è¨ˆã¨å‰Šé™¤
    myCards = myCards.filter(c => {
      if(selectedCards.has(c.uniqueId)) {
        sellTotal += c.point;
        return false; // ãƒªã‚¹ãƒˆã‹ã‚‰é™¤å¤–
      }
      return true; // æ®‹ã™
    });

    userPoints += sellTotal;
    updateUI();
    
    // UIæ›´æ–°
    renderInventory();
    alert(`${sellTotal.toLocaleString()} pt ç²å¾—ã—ã¾ã—ãŸï¼`);
  }

</script>
</body>
</html>
